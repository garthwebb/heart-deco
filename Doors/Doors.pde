// Test user input controls
// 

import com.heroicrobot.dropbit.registry.*;
import com.heroicrobot.dropbit.devices.pixelpusher.Pixel;
import com.heroicrobot.dropbit.devices.pixelpusher.Strip;
import java.util.*;
import processing.core.*;

DeviceRegistry registry;

int canvasWidth = 1100; //1300;//990;
int canvasHeight = 400; //220;

// Positions of the LEDs in each strip
int[][][] ledPos = {
  // 218 lights
  //{ {642,10}, {639,11}, {636,12}, {633,13}, {630,14}, {627,15}, {624,16}, {622,16}, {619,17}, {616,18}, {613,19}, {610,20}, {607,21}, {604,22}, {601,22}, {599,23}, {596,24}, {593,25}, {590,26}, {587,27}, {584,28}, {581,28}, {578,29}, {576,30}, {573,31}, {570,32}, {567,33}, {564,34}, {561,35}, {558,35}, {555,36}, {553,37}, {550,38}, {547,39}, {544,40}, {541,41}, {538,41}, {535,42}, {532,43}, {530,44}, {527,45}, {524,46}, {521,47}, {518,47}, {515,48}, {512,49}, {509,50}, {507,51}, {504,52}, {501,53}, {498,54}, {495,54}, {492,55}, {489,56}, {486,57}, {484,58}, {481,59}, {478,60}, {475,60}, {472,61}, {469,62}, {466,63}, {464,64}, {461,65}, {458,66}, {455,66}, {452,67}, {449,68}, {446,69}, {443,70}, {441,71}, {438,72}, {435,73}, {432,73}, {429,74}, {426,75}, {423,76}, {420,77}, {418,78}, {415,79}, {412,79}, {409,80}, {406,81}, {403,82}, {400,83}, {397,84}, {395,85}, {392,85}, {389,86}, {386,87}, {383,88}, {380,89}, {377,90}, {374,91}, {372,92}, {369,92}, {366,93}, {363,94}, {360,95}, {357,96}, {354,97}, {351,98}, {349,98}, {346,99}, {343,100}, {340,101}, {337,102}, {334,103}, {331,104}, {328,104}, {326,105}, {323,106}, {320,107}, {317,108}, {314,109}, {311,110}, {308,111}, {305,111}, {303,112}, {300,113}, {297,114}, {294,115}, {291,116}, {288,117}, {285,117}, {283,118}, {280,119}, {277,120}, {274,121}, {271,122}, {268,123}, {265,123}, {262,124}, {260,125}, {257,126}, {254,127}, {251,128}, {248,129}, {245,130}, {242,130}, {239,131}, {237,132}, {234,133}, {231,134}, {228,135}, {225,136}, {222,136}, {219,137}, {216,138}, {214,139}, {211,140}, {208,141}, {205,142}, {202,142}, {199,143}, {196,144}, {193,145}, {191,146}, {188,147}, {185,148}, {182,149}, {179,149}, {176,150}, {173,151}, {170,152}, {168,153}, {165,154}, {162,155}, {159,155}, {156,156}, {153,157}, {150,158}, {147,159}, {145,160}, {142,161}, {139,161}, {136,162}, {133,163}, {130,164}, {127,165}, {124,166}, {122,167}, {119,168}, {116,168}, {113,169}, {110,170}, {107,171}, {104,172}, {102,173}, {99,174}, {96,174}, {93,175}, {90,176}, {87,177}, {84,178}, {81,179}, {79,180}, {76,180}, {73,181}, {70,182}, {67,183}, {64,184}, {61,185}, {58,186}, {56,187}, {53,187}, {50,188}, {47,189}, {44,190}, {41,191}, {38,192}, {35,193}, {33,193}, {30,194}, {27,195}, {24,196}, {21,197}, {18,198} },
  { {545, 10}, {542, 11}, {540, 13}, {537, 15}, {535, 16}, {532, 18}, {530, 20}, {527, 22}, {525, 23}, {523, 25}, {520, 27}, {518, 29}, {515, 30}, {513, 32}, {510, 34}, {508, 36}, {505, 37}, {503, 39}, {501, 41}, {498, 43}, {496, 44}, {493, 46}, {491, 48}, {488, 50}, {486, 51}, {483, 53}, {481, 55}, {479, 57}, {476, 58}, {474, 60}, {471, 62}, {469, 64}, {466, 65}, {464, 67}, {461, 69}, {459, 70}, {457, 72}, {454, 74}, {452, 76}, {449, 77}, {447, 79}, {444, 81}, {442, 83}, {439, 84}, {437, 86}, {435, 88}, {432, 90}, {430, 91}, {427, 93}, {425, 95}, {422, 97}, {420, 98}, {417, 100}, {415, 102}, {413, 104}, {410, 105}, {408, 107}, {405, 109}, {403, 111}, {400, 112}, {398, 114}, {396, 116}, {393, 118}, {391, 119}, {388, 121}, {386, 123}, {383, 124}, {381, 126}, {378, 128}, {376, 130}, {374, 131}, {371, 133}, {369, 135}, {366, 137}, {364, 138}, {361, 140}, {359, 142}, {356, 144}, {354, 145}, {352, 147}, {349, 149}, {347, 151}, {344, 152}, {342, 154}, {339, 156}, {337, 158}, {334, 159}, {332, 161}, {330, 163}, {327, 165}, {325, 166}, {322, 168}, {320, 170}, {317, 172}, {315, 173}, {312, 175}, {310, 177}, {308, 178}, {305, 180}, {303, 182}, {300, 184}, {298, 185}, {295, 187}, {293, 189}, {290, 191}, {288, 192}, {286, 194}, {283, 196}, {281, 198}, {278, 199}, {276, 201}, {273, 203}, {271, 205}, {269, 206}, {266, 208}, {264, 210}, {261, 212}, {259, 213}, {256, 215}, {254, 217}, {251, 219}, {249, 220}, {247, 222}, {244, 224}, {242, 226}, {239, 227}, {237, 229}, {234, 231}, {232, 232}, {229, 234}, {227, 236}, {225, 238}, {222, 239}, {220, 241}, {217, 243}, {215, 245}, {212, 246}, {210, 248}, {207, 250}, {205, 252}, {203, 253}, {200, 255}, {198, 257}, {195, 259}, {193, 260}, {190, 262}, {188, 264}, {185, 266}, {183, 267}, {181, 269}, {178, 271}, {176, 273}, {173, 274}, {171, 276}, {168, 278}, {166, 280}, {163, 281}, {161, 283}, {159, 285}, {156, 286}, {154, 288}, {151, 290}, {149, 292}, {146, 293}, {144, 295}, {142, 297}, {139, 299}, {137, 300}, {134, 302}, {132, 304}, {129, 306}, {127, 307}, {124, 309}, {122, 311}, {120, 313}, {117, 314}, {115, 316}, {112, 318}, {110, 320}, {107, 321}, {105, 323}, {102, 325}, {100, 327}, {98, 328}, {95, 330}, {93, 332}, {90, 334}, {88, 335}, {85, 337}, {83, 339}, {80, 341}, {78, 342}, {76, 344}, {73, 346}, {71, 347}, {68, 349}, {66, 351}, {63, 353}, {61, 354}, {58, 356}, {56, 358}, {54, 360}, {51, 361}, {49, 363}, {46, 365}, {44, 367}, {41, 368}, {39, 370}, {36, 372}, {34, 374}, {32, 375}, {29, 377}, {27, 379}, {24, 381}, {22, 382}, {19, 384}, {17, 386}, {15, 388}, {12, 389}, {10, 391}, {7, 393} },
  // 240 lights
  //{ {645,10}, {643,12}, {641,14}, {639,16}, {637,19}, {635,21}, {633,23}, {631,26}, {629,28}, {627,30}, {625,33}, {623,35}, {622,37}, {620,40}, {618,42}, {616,44}, {614,46}, {612,49}, {610,51}, {608,53}, {606,56}, {604,58}, {602,60}, {600,63}, {599,65}, {597,67}, {595,70}, {593,72}, {591,74}, {589,77}, {587,79}, {585,81}, {583,83}, {581,86}, {579,88}, {578,90}, {576,93}, {574,95}, {572,97}, {570,100}, {568,102}, {566,104}, {564,107}, {562,109}, {560,111}, {558,113}, {556,116}, {555,118}, {553,120}, {551,123}, {549,125}, {547,127}, {545,130}, {543,132}, {541,134}, {539,137}, {537,139}, {535,141}, {534,144}, {532,146}, {530,148}, {528,150}, {526,153}, {524,155}, {522,157}, {520,160}, {518,162}, {516,164}, {514,167}, {512,169}, {511,171}, {509,174}, {507,176}, {505,178}, {503,180}, {501,183}, {499,185}, {497,187}, {495,190}, {493,192}, {491,194}, {490, 197}, {487, 197}, {484, 197}, {481, 197}, {478, 197}, {475, 197}, {472, 197}, {469, 197}, {466, 197}, {463, 197}, {460, 197}, {457, 197}, {454, 197}, {451, 197}, {448, 197}, {445, 197}, {442, 197}, {439, 197}, {436, 197}, {433, 197}, {430, 197}, {427, 197}, {424, 197}, {421, 197}, {418, 197}, {415, 197}, {412, 197}, {409, 197}, {406, 197}, {403, 197}, {400, 197}, {397, 197}, {394, 197}, {391, 197}, {388, 197}, {385, 197}, {382, 197}, {379, 197}, {376, 197}, {373, 197}, {370, 197}, {367, 197}, {364, 197}, {361, 197}, {358, 197}, {355, 197}, {352, 197}, {349, 197}, {346, 197}, {343, 197}, {340, 197}, {337, 197}, {334, 197}, {331, 197}, {328, 197}, {325, 197}, {322, 197}, {319, 197}, {316, 197}, {313, 197}, {310, 197}, {307, 197}, {304, 197}, {301, 197}, {298, 197}, {295, 197}, {292, 197}, {289, 197}, {286, 197}, {283, 197}, {280, 197}, {277, 197}, {274, 197}, {271, 197}, {268, 197}, {265, 197}, {262, 197}, {259, 197}, {256, 197}, {253, 197}, {250, 197}, {247, 197}, {244, 197}, {241, 197}, {238, 197}, {235, 197}, {232, 197}, {229, 197}, {226, 197}, {223, 197}, {220, 197}, {217, 197}, {214, 197}, {211, 197}, {208, 197}, {205, 197}, {202, 197}, {199, 197}, {196, 197}, {193, 197}, {190, 197}, {187, 197}, {184, 197}, {181, 197}, {178, 197}, {175, 197}, {172, 197}, {169, 197}, {166, 197}, {163, 197}, {160, 197}, {157, 197}, {154, 197}, {151, 197}, {148, 197}, {145, 197}, {142, 197}, {139, 197}, {136, 197}, {133, 197}, {130, 197}, {127, 197}, {124, 197}, {121, 197}, {118, 197}, {115, 197}, {112, 197}, {109, 197}, {106, 197}, {103, 197}, {100, 197}, {97, 197}, {94, 197}, {91, 197}, {88, 197}, {85, 197}, {82, 197}, {79, 197}, {76, 197}, {73, 197}, {70, 197}, {67, 197}, {64, 197}, {61, 197}, {58, 197}, {55, 197}, {52, 197}, {49, 197}, {46, 197}, {43, 197}, {40, 197}, {37, 197}, {34, 197}, {31, 197}, {28, 197}, {25, 197}, {22, 197}, {19, 197}, {16, 197} },
  { {545, 10}, {543, 12}, {541, 14}, {539, 17}, {537, 19}, {535, 21}, {534, 24}, {532, 26}, {530, 29}, {528, 31}, {526, 33}, {524, 36}, {523, 38}, {521, 40}, {519, 43}, {517, 45}, {515, 48}, {513, 50}, {512, 52}, {510, 55}, {508, 57}, {506, 59}, {504, 62}, {502, 64}, {501, 67}, {499, 69}, {497, 71}, {495, 74}, {493, 76}, {491, 78}, {490, 81}, {488, 83}, {486, 86}, {484, 88}, {482, 90}, {480, 93}, {479, 95}, {477, 97}, {475, 100}, {473, 102}, {471, 105}, {469, 107}, {468, 109}, {466, 112}, {464, 114}, {462, 116}, {460, 119}, {458, 121}, {457, 124}, {455, 126}, {453, 128}, {451, 131}, {449, 133}, {447, 135}, {446, 138}, {444, 140}, {442, 143}, {440, 145}, {438, 147}, {437, 150}, {435, 152}, {433, 154}, {431, 157}, {429, 159}, {427, 162}, {426, 164}, {424, 166}, {422, 169}, {420, 171}, {418, 174}, {416, 176}, {415, 178}, {413, 181}, {411, 183}, {409, 185}, {407, 188}, {405, 190}, {404, 193}, {402, 195}, {400, 197}, {398, 200}, {396, 202}, {394, 204}, {393, 207}, {391, 209}, {389, 212}, {387, 214}, {385, 216}, {383, 219}, {382, 221}, {380, 223}, {378, 226}, {376, 228}, {374, 231}, {372, 233}, {371, 235}, {369, 238}, {367, 240}, {365, 242}, {363, 245}, {361, 247}, {360, 250}, {358, 252}, {356, 254}, {354, 257}, {352, 259}, {350, 261}, {349, 264}, {347, 266}, {345, 269}, {343, 271}, {341, 273}, {339, 276}, {338, 278}, {336, 280}, {334, 283}, {332, 285}, {330, 288}, {329, 290}, {327, 292}, {325, 295}, {323, 297}, {321, 299}, {319, 302}, {318, 304}, {316, 307}, {314, 309}, {312, 311}, {310, 314}, {308, 316}, {307, 318}, {305, 321}, {303, 323}, {301, 326}, {299, 328}, {297, 330}, {296, 333}, {294, 335}, {292, 338}, {290, 340}, {288, 342}, {286, 345}, {285, 347}, {283, 349}, {281, 352}, {279, 354}, {277, 357}, {275, 359}, {274, 361}, {272, 364}, {270, 366}, {268, 368}, {266, 371}, {264, 373}, {263, 376}, {261, 378}, {259, 380}, {257, 383}, {255, 385},
    {253, 387}, {250, 387}, {247, 387}, {244, 387}, {241, 387}, {238, 387}, {235, 387}, {232, 387}, {229, 387}, {226, 387}, {223, 387}, {220, 387}, {217, 387}, {214, 387}, {211, 387}, {208, 387}, {205, 387}, {202, 387}, {199, 387}, {196, 387}, {193, 387}, {190, 387}, {187, 387}, {184, 387}, {181, 387}, {178, 387}, {175, 387}, {172, 387}, {169, 387}, {166, 387}, {163, 387}, {160, 387}, {157, 387}, {154, 387}, {151, 387}, {148, 387}, {145, 387}, {142, 387}, {139, 387}, {136, 387}, {133, 387}, {130, 387}, {127, 387}, {124, 387}, {121, 387}, {118, 387}, {115, 387}, {112, 387}, {109, 387}, {106, 387}, {103, 387}, {100, 387}, {97, 387}, {94, 387}, {91, 387}, {88, 387}, {85, 387}, {82, 387}, {79, 387}, {76, 387}, {73, 387}, {70, 387}, {67, 387}, {64, 387}, {61, 387}, {58, 387}, {55, 387}, {52, 387}, {49, 387}, {46, 387}, {43, 387}, {40, 387}, {37, 387}, {34, 387}, {31, 387}, {28, 387}, {25, 387}, {22, 387}, {19, 387}, {16, 387}, {13, 387}
  },

  // 218 lights
  //{ {657,10}, {660,11}, {663,12}, {666,13}, {669,14}, {672,15}, {675,16}, {677,16}, {680,17}, {683,18}, {686,19}, {689,20}, {692,21}, {695,22}, {698,22}, {700,23}, {703,24}, {706,25}, {709,26}, {712,27}, {715,28}, {718,28}, {721,29}, {723,30}, {726,31}, {729,32}, {732,33}, {735,34}, {738,35}, {741,35}, {744,36}, {746,37}, {749,38}, {752,39}, {755,40}, {758,41}, {761,41}, {764,42}, {767,43}, {769,44}, {772,45}, {775,46}, {778,47}, {781,47}, {784,48}, {787,49}, {790,50}, {792,51}, {795,52}, {798,53}, {801,54}, {804,54}, {807,55}, {810,56}, {813,57}, {815,58}, {818,59}, {821,60}, {824,60}, {827,61}, {830,62}, {833,63}, {835,64}, {838,65}, {841,66}, {844,66}, {847,67}, {850,68}, {853,69}, {856,70}, {858,71}, {861,72}, {864,73}, {867,73}, {870,74}, {873,75}, {876,76}, {879,77}, {881,78}, {884,79}, {887,79}, {890,80}, {893,81}, {896,82}, {899,83}, {902,84}, {904,85}, {907,85}, {910,86}, {913,87}, {916,88}, {919,89}, {922,90}, {925,91}, {927,92}, {930,92}, {933,93}, {936,94}, {939,95}, {942,96}, {945,97}, {948,98}, {950,98}, {953,99}, {956,100}, {959,101}, {962,102}, {965,103}, {968,104}, {971,104}, {973,105}, {976,106}, {979,107}, {982,108}, {985,109}, {988,110}, {991,111}, {994,111}, {996,112}, {999,113}, {1002,114}, {1005,115}, {1008,116}, {1011,117}, {1014,117}, {1016,118}, {1019,119}, {1022,120}, {1025,121}, {1028,122}, {1031,123}, {1034,123}, {1037,124}, {1039,125}, {1042,126}, {1045,127}, {1048,128}, {1051,129}, {1054,130}, {1057,130}, {1060,131}, {1062,132}, {1065,133}, {1068,134}, {1071,135}, {1074,136}, {1077,136}, {1080,137}, {1083,138}, {1085,139}, {1088,140}, {1091,141}, {1094,142}, {1097,142}, {1100,143}, {1103,144}, {1106,145}, {1108,146}, {1111,147}, {1114,148}, {1117,149}, {1120,149}, {1123,150}, {1126,151}, {1129,152}, {1131,153}, {1134,154}, {1137,155}, {1140,155}, {1143,156}, {1146,157}, {1149,158}, {1152,159}, {1154,160}, {1157,161}, {1160,161}, {1163,162}, {1166,163}, {1169,164}, {1172,165}, {1175,166}, {1177,167}, {1180,168}, {1183,168}, {1186,169}, {1189,170}, {1192,171}, {1195,172}, {1197,173}, {1200,174}, {1203,174}, {1206,175}, {1209,176}, {1212,177}, {1215,178}, {1218,179}, {1220,180}, {1223,180}, {1226,181}, {1229,182}, {1232,183}, {1235,184}, {1238,185}, {1241,186}, {1243,187}, {1246,187}, {1249,188}, {1252,189}, {1255,190}, {1258,191}, {1261,192}, {1264,193}, {1266,193}, {1269,194}, {1272,195}, {1275,196}, {1278,197}, {1281,198} },
  { {555, 10}, {557, 11}, {559, 13}, {562, 15}, {564, 16}, {567, 18}, {569, 20}, {572, 22}, {574, 23}, {576, 25}, {579, 27}, {581, 29}, {584, 30}, {586, 32}, {589, 34}, {591, 36}, {594, 37}, {596, 39}, {598, 41}, {601, 43}, {603, 44}, {606, 46}, {608, 48}, {611, 50}, {613, 51}, {616, 53}, {618, 55}, {620, 57}, {623, 58}, {625, 60}, {628, 62}, {630, 64}, {633, 65}, {635, 67}, {638, 69}, {640, 70}, {642, 72}, {645, 74}, {647, 76}, {650, 77}, {652, 79}, {655, 81}, {657, 83}, {660, 84}, {662, 86}, {664, 88}, {667, 90}, {669, 91}, {672, 93}, {674, 95}, {677, 97}, {679, 98}, {682, 100}, {684, 102}, {686, 104}, {689, 105}, {691, 107}, {694, 109}, {696, 111}, {699, 112}, {701, 114}, {703, 116}, {706, 118}, {708, 119}, {711, 121}, {713, 123}, {716, 124}, {718, 126}, {721, 128}, {723, 130}, {725, 131}, {728, 133}, {730, 135}, {733, 137}, {735, 138}, {738, 140}, {740, 142}, {743, 144}, {745, 145}, {747, 147}, {750, 149}, {752, 151}, {755, 152}, {757, 154}, {760, 156}, {762, 158}, {765, 159}, {767, 161}, {769, 163}, {772, 165}, {774, 166}, {777, 168}, {779, 170}, {782, 172}, {784, 173}, {787, 175}, {789, 177}, {791, 178}, {794, 180}, {796, 182}, {799, 184}, {801, 185}, {804, 187}, {806, 189}, {809, 191}, {811, 192}, {813, 194}, {816, 196}, {818, 198}, {821, 199}, {823, 201}, {826, 203}, {828, 205}, {830, 206}, {833, 208}, {835, 210}, {838, 212}, {840, 213}, {843, 215}, {845, 217}, {848, 219}, {850, 220}, {852, 222}, {855, 224}, {857, 226}, {860, 227}, {862, 229}, {865, 231}, {867, 232}, {870, 234}, {872, 236}, {874, 238}, {877, 239}, {879, 241}, {882, 243}, {884, 245}, {887, 246}, {889, 248}, {892, 250}, {894, 252}, {896, 253}, {899, 255}, {901, 257}, {904, 259}, {906, 260}, {909, 262}, {911, 264}, {914, 266}, {916, 267}, {918, 269}, {921, 271}, {923, 273}, {926, 274}, {928, 276}, {931, 278}, {933, 280}, {936, 281}, {938, 283}, {940, 285}, {943, 286}, {945, 288}, {948, 290}, {950, 292}, {953, 293}, {955, 295}, {957, 297}, {960, 299}, {962, 300}, {965, 302}, {967, 304}, {970, 306}, {972, 307}, {975, 309}, {977, 311}, {979, 313}, {982, 314}, {984, 316}, {987, 318}, {989, 320}, {992, 321}, {994, 323}, {997, 325}, {999, 327}, {1001, 328}, {1004, 330}, {1006, 332}, {1009, 334}, {1011, 335}, {1014, 337}, {1016, 339}, {1019, 341}, {1021, 342}, {1023, 344}, {1026, 346}, {1028, 347}, {1031, 349}, {1033, 351}, {1036, 353}, {1038, 354}, {1041, 356}, {1043, 358}, {1045, 360}, {1048, 361}, {1050, 363}, {1053, 365}, {1055, 367}, {1058, 368}, {1060, 370}, {1063, 372}, {1065, 374}, {1067, 375}, {1070, 377}, {1072, 379}, {1075, 381}, {1077, 382}, {1080, 384}, {1082, 386}, {1084, 388}, {1087, 389}, {1089, 391}, {1092, 393} },
  // 240 lights
  //{ {655,10}, {656,12}, {658,14}, {660,16}, {662,19}, {664,21}, {666,23}, {668,26}, {670,28}, {672,30}, {674,33}, {676,35}, {677,37}, {679,40}, {681,42}, {683,44}, {685,46}, {687,49}, {689,51}, {691,53}, {693,56}, {695,58}, {697,60}, {699,63}, {700,65}, {702,67}, {704,70}, {706,72}, {708,74}, {710,77}, {712,79}, {714,81}, {716,83}, {718,86}, {720,88}, {721,90}, {723,93}, {725,95}, {727,97}, {729,100}, {731,102}, {733,104}, {735,107}, {737,109}, {739,111}, {741,113}, {743,116}, {744,118}, {746,120}, {748,123}, {750,125}, {752,127}, {754,130}, {756,132}, {758,134}, {760,137}, {762,139}, {764,141}, {765,144}, {767,146}, {769,148}, {771,150}, {773,153}, {775,155}, {777,157}, {779,160}, {781,162}, {783,164}, {785,167}, {787,169}, {788,171}, {790,174}, {792,176}, {794,178}, {796,180}, {798,183}, {800,185}, {802,187}, {804,190}, {806,192}, {808,194}, {809, 197}, {812, 197}, {815, 197}, {818, 197}, {821, 197}, {824, 197}, {827, 197}, {830, 197}, {833, 197}, {836, 197}, {839, 197}, {842, 197}, {845, 197}, {848, 197}, {851, 197}, {854, 197}, {857, 197}, {860, 197}, {863, 197}, {866, 197}, {869, 197}, {872, 197}, {875, 197}, {878, 197}, {881, 197}, {884, 197}, {887, 197}, {890, 197}, {893, 197}, {896, 197}, {899, 197}, {902, 197}, {905, 197}, {908, 197}, {911, 197}, {914, 197}, {917, 197}, {920, 197}, {923, 197}, {926, 197}, {929, 197}, {932, 197}, {935, 197}, {938, 197}, {941, 197}, {944, 197}, {947, 197}, {950, 197}, {953, 197}, {956, 197}, {959, 197}, {962, 197}, {965, 197}, {968, 197}, {971, 197}, {974, 197}, {977, 197}, {980, 197}, {983, 197}, {986, 197}, {989, 197}, {992, 197}, {995, 197}, {998, 197}, {1001, 197}, {1004, 197}, {1007, 197}, {1010, 197}, {1013, 197}, {1016, 197}, {1019, 197}, {1022, 197}, {1025, 197}, {1028, 197}, {1031, 197}, {1034, 197}, {1037, 197}, {1040, 197}, {1043, 197}, {1046, 197}, {1049, 197}, {1052, 197}, {1055, 197}, {1058, 197}, {1061, 197}, {1064, 197}, {1067, 197}, {1070, 197}, {1073, 197}, {1076, 197}, {1079, 197}, {1082, 197}, {1085, 197}, {1088, 197}, {1091, 197}, {1094, 197}, {1097, 197}, {1100, 197}, {1103, 197}, {1106, 197}, {1109, 197}, {1112, 197}, {1115, 197}, {1118, 197}, {1121, 197}, {1124, 197}, {1127, 197}, {1130, 197}, {1133, 197}, {1136, 197}, {1139, 197}, {1142, 197}, {1145, 197}, {1148, 197}, {1151, 197}, {1154, 197}, {1157, 197}, {1160, 197}, {1163, 197}, {1166, 197}, {1169, 197}, {1172, 197}, {1175, 197}, {1178, 197}, {1181, 197}, {1184, 197}, {1187, 197}, {1190, 197}, {1193, 197}, {1196, 197}, {1199, 197}, {1202, 197}, {1205, 197}, {1208, 197}, {1211, 197}, {1214, 197}, {1217, 197}, {1220, 197}, {1223, 197}, {1226, 197}, {1229, 197}, {1232, 197}, {1235, 197}, {1238, 197}, {1241, 197}, {1244, 197}, {1247, 197}, {1250, 197}, {1253, 197}, {1256, 197}, {1259, 197}, {1262, 197}, {1265, 197}, {1268, 197}, {1271, 197}, {1274, 197}, {1277, 197}, {1280, 197}, {1283, 197} }
  {
    {555, 10}, {556, 12}, {558, 14}, {560, 17}, {562, 19}, {564, 21}, {565, 24}, {567, 26}, {569, 29}, {571, 31}, {573, 33}, {575, 36}, {576, 38}, {578, 40}, {580, 43}, {582, 45}, {584, 48}, {586, 50}, {587, 52}, {589, 55}, {591, 57}, {593, 59}, {595, 62}, {597, 64}, {598, 67}, {600, 69}, {602, 71}, {604, 74}, {606, 76}, {608, 78}, {609, 81}, {611, 83}, {613, 86}, {615, 88}, {617, 90}, {619, 93}, {620, 95}, {622, 97}, {624, 100}, {626, 102}, {628, 105}, {630, 107}, {631, 109}, {633, 112}, {635, 114}, {637, 116}, {639, 119}, {641, 121}, {642, 124}, {644, 126}, {646, 128}, {648, 131}, {650, 133}, {652, 135}, {653, 138}, {655, 140}, {657, 143}, {659, 145}, {661, 147}, {662, 150}, {664, 152}, {666, 154}, {668, 157}, {670, 159}, {672, 162}, {673, 164}, {675, 166}, {677, 169}, {679, 171}, {681, 174}, {683, 176}, {684, 178}, {686, 181}, {688, 183}, {690, 185}, {692, 188}, {694, 190}, {695, 193}, {697, 195}, {699, 197}, {701, 200}, {703, 202}, {705, 204}, {706, 207}, {708, 209}, {710, 212}, {712, 214}, {714, 216}, {716, 219}, {717, 221}, {719, 223}, {721, 226}, {723, 228}, {725, 231}, {727, 233}, {728, 235}, {730, 238}, {732, 240}, {734, 242}, {736, 245}, {738, 247}, {739, 250}, {741, 252}, {743, 254}, {745, 257}, {747, 259}, {749, 261}, {750, 264}, {752, 266}, {754, 269}, {756, 271}, {758, 273}, {760, 276}, {761, 278}, {763, 280}, {765, 283}, {767, 285}, {769, 288}, {770, 290}, {772, 292}, {774, 295}, {776, 297}, {778, 299}, {780, 302}, {781, 304}, {783, 307}, {785, 309}, {787, 311}, {789, 314}, {791, 316}, {792, 318}, {794, 321}, {796, 323}, {798, 326}, {800, 328}, {802, 330}, {803, 333}, {805, 335}, {807, 338}, {809, 340}, {811, 342}, {813, 345}, {814, 347}, {816, 349}, {818, 352}, {820, 354}, {822, 357}, {824, 359}, {825, 361}, {827, 364}, {829, 366}, {831, 368}, {833, 371}, {835, 373}, {836, 376}, {838, 378}, {840, 380}, {842, 383}, {844, 385},
    {846, 387}, {849, 387}, {852, 387}, {855, 387}, {858, 387}, {861, 387}, {864, 387}, {867, 387}, {870, 387}, {873, 387}, {876, 387}, {879, 387}, {882, 387}, {885, 387}, {888, 387}, {891, 387}, {894, 387}, {897, 387}, {900, 387}, {903, 387}, {906, 387}, {909, 387}, {912, 387}, {915, 387}, {918, 387}, {921, 387}, {924, 387}, {927, 387}, {930, 387}, {933, 387}, {936, 387}, {939, 387}, {942, 387}, {945, 387}, {948, 387}, {951, 387}, {954, 387}, {957, 387}, {960, 387}, {963, 387}, {966, 387}, {969, 387}, {972, 387}, {975, 387}, {978, 387}, {981, 387}, {984, 387}, {987, 387}, {990, 387}, {993, 387}, {996, 387}, {999, 387}, {1002, 387}, {1005, 387}, {1008, 387}, {1011, 387}, {1014, 387}, {1017, 387}, {1020, 387}, {1023, 387}, {1026, 387}, {1029, 387}, {1032, 387}, {1035, 387}, {1038, 387}, {1041, 387}, {1044, 387}, {1047, 387}, {1050, 387}, {1053, 387}, {1056, 387}, {1059, 387}, {1062, 387}, {1065, 387}, {1068, 387}, {1071, 387}, {1074, 387}, {1077, 387}, {1080, 387}, {1083, 387}, {1086, 387}
  }
};

int[] stripLen = { 218, 240, 218, 240 };

// The order the pixels should be lit in order to form a horizontal "line" between the two strips
int[][] horzOrder = { {0, 0}, {0, 1}, {1, 2}, {1, 3}, {2, 4}, {3, 5}, {3, 6}, {4, 7}, {5, 8}, {5, 9}, {6, 10}, {7, 11}, {7, 12}, {8, 13}, {8, 14}, {9, 15}, {10, 16}, {10, 17}, {11, 18}, {12, 19}, {12, 20}, {13, 21}, {14, 22}, {14, 23}, {15, 24}, {15, 25}, {16, 26}, {17, 27}, {17, 28}, {18, 29}, {19, 30}, {19, 31}, {20, 32}, {21, 33}, {21, 34}, {22, 35}, {22, 36}, {23, 37}, {24, 38}, {24, 39}, {25, 40}, {26, 41}, {26, 42}, {27, 43}, {28, 44}, {28, 45}, {29, 46}, {29, 47}, {30, 48}, {31, 49}, {31, 50}, {32, 51}, {33, 52}, {33, 53}, {34, 54}, {35, 55}, {35, 56}, {36, 57}, {36, 58}, {37, 59}, {38, 60}, {38, 61}, {39, 62}, {40, 63}, {40, 64}, {41, 65}, {42, 66}, {42, 67}, {43, 68}, {43, 69}, {44, 70}, {45, 71}, {45, 72}, {46, 73}, {47, 74}, {47, 75}, {48, 76}, {49, 77}, {49, 78}, {50, 79}, {51, 80}, {51, 80}, {52, 80}, {52, 81}, {53, 81}, {54, 82}, {54, 83}, {55, 83}, {56, 84}, {56, 84}, {57, 85}, {58, 86}, {58, 86}, {59, 87}, {59, 87}, {60, 88}, {61, 89}, {61, 89}, {62, 90}, {63, 90}, {63, 91}, {64, 92}, {65, 92}, {65, 93}, {66, 94}, {66, 94}, {67, 95}, {68, 95}, {68, 96}, {69, 97}, {70, 97}, {70, 98}, {71, 98}, {72, 99}, {72, 100}, {73, 100}, {73, 101}, {74, 101}, {75, 102}, {75, 103}, {76, 103}, {77, 104}, {77, 105}, {78, 105}, {79, 106}, {79, 106}, {80, 107}, {80, 108}, {81, 108}, {82, 109}, {82, 109}, {83, 110}, {84, 111}, {84, 111}, {85, 112}, {86, 112}, {86, 113}, {87, 114}, {87, 114}, {88, 115}, {89, 115}, {89, 116}, {90, 117}, {91, 117}, {91, 118}, {92, 119}, {93, 119}, {93, 120}, {94, 120}, {95, 121}, {95, 122}, {96, 122}, {96, 123}, {97, 123}, {98, 124}, {98, 125}, {99, 125}, {100, 126}, {100, 126}, {101, 127}, {102, 128}, {102, 128}, {103, 129}, {103, 130}, {104, 130}, {105, 131}, {105, 131}, {106, 132}, {107, 133}, {107, 133}, {108, 134}, {109, 134}, {109, 135}, {110, 136}, {110, 136}, {111, 137}, {112, 137}, {112, 138}, {113, 139}, {114, 139}, {114, 140}, {115, 141}, {116, 141}, {116, 142}, {117, 142}, {117, 143}, {118, 144}, {119, 144}, {119, 145}, {120, 145}, {121, 146}, {121, 147}, {122, 147}, {123, 148}, {123, 148}, {124, 149}, {124, 150}, {125, 150}, {126, 151}, {126, 151}, {127, 152}, {128, 153}, {128, 153}, {129, 154}, {130, 155}, {130, 155}, {131, 156}, {131, 156}, {132, 157}, {133, 158}, {133, 158}, {134, 159}, {135, 159}, {135, 160}, {136, 161}, {137, 161}, {137, 162}, {138, 162}, {139, 163}, {139, 164}, {140, 164}, {140, 165}, {141, 166}, {142, 166}, {142, 167}, {143, 167}, {144, 168}, {144, 169}, {145, 169}, {146, 170}, {146, 170}, {147, 171}, {147, 172}, {148, 172}, {149, 173}, {149, 173}, {150, 174}, {151, 175}, {151, 175}, {152, 176}, {153, 177}, {153, 177}, {154, 178}, {154, 178}, {155, 179}, {156, 180}, {156, 180}, {157, 181}, {158, 181}, {158, 182}, {159, 183}, {160, 183}, {160, 184}, {161, 184}, {161, 185}, {162, 186}, {163, 186}, {163, 187}, {164, 187}, {165, 188}, {165, 189}, {166, 189}, {167, 190}, {167, 191}, {168, 191}, {168, 192}, {169, 192}, {170, 193}, {170, 194}, {171, 194}, {172, 195}, {172, 195}, {173, 196}, {174, 197}, {174, 197}, {175, 198}, {175, 198}, {176, 199}, {177, 200}, {177, 200}, {178, 201}, {179, 202}, {179, 202}, {180, 203}, {181, 203}, {181, 204}, {182, 205}, {183, 205}, {183, 206}, {184, 206}, {184, 207}, {185, 208}, {186, 208}, {186, 209}, {187, 209}, {188, 210}, {188, 211}, {189, 211}, {190, 212}, {190, 213}, {191, 213}, {191, 214}, {192, 214}, {193, 215}, {193, 216}, {194, 216}, {195, 217}, {195, 217}, {196, 218}, {197, 219}, {197, 219}, {198, 220}, {198, 220}, {199, 221}, {200, 222}, {200, 222}, {201, 223}, {202, 223}, {202, 224}, {203, 225}, {204, 225}, {204, 226}, {205, 227}, {205, 227}, {206, 228}, {207, 228}, {207, 229}, {208, 230}, {209, 230}, {209, 231}, {210, 231}, {211, 232}, {211, 233}, {212, 233}, {212, 234}, {213, 234}, {214, 235}, {214, 236}, {215, 236}, {216, 237}, {216, 238}, {217, 238}, {218, 239}, {218, 239}, {219, 240}};


// Color value of each LED
color[][] ledVal = new color[4][240];

int last = millis();

void setup() {
  size(canvasWidth, canvasHeight);

  background(0);
  colorMode(HSB, 100);

  stroke(0,0,50);
  fill(0,0,0);
  triangle(633,17, 486,193, 45,193);
  triangle(664,17, 813,193, 1254,193);

  stroke(0);
  fill(60, 100, 100);
  for (int strip=0; strip<4; strip++) {
    for (int led=0; led<stripLen[strip]; led++) {
      int[] pos = ledPos[strip][led];
      ellipse(pos[0], pos[1], 3, 3);
    }
  }

  registry = new DeviceRegistry();
  registry.setExtraDelay(0);
  registry.startPushing();
}

void draw() {
  //fxSweep();
  //fxBarSweep();
  fxFlame();
  drawScreen();
}

int[] toDraw = new int[240];
void drawScreen() {
  clear();

  List<Strip> allStrips = registry.getStrips();
  int numStrips = allStrips.size();

  for (int strip=0; strip<4; strip++) {
    int toDrawIdx = -1;

    for (int led=0; led<stripLen[strip]; led++) {
      int[] pos = ledPos[strip][led];
      int c = ledVal[strip][led];

      if (strip < numStrips) {
        Strip curStrip = allStrips.get(strip);
        curStrip.setPixel(c, led);
      }

      if ( c != color(0) ) {
        fill(c);
        ellipse(pos[0], pos[1], 10, 10);
      }
    }
  }
}

// Transform Clear
// Clear the LEDs
void xformClear() {
  for (int strip=0; strip<4; strip++) {
    for (int led=0; led<240; led++) {
      ledVal[strip][led] = color(0);
    } 
  }
}

// Effect Sweep
// A single light sweeps back and forth
int[] fxSweepPos = { 0, 20, 0, 20 };
int[] fxSweepDir = { 1, 1, 1, 1 };

void fxSweep() {
  for (int strip=0; strip<4; strip++) {
    int pos = fxSweepPos[strip];
    int dir = fxSweepDir[strip];

    // Blank out the previous LED
    ledVal[strip][pos] = color(0);

    // Set the direction for each lights movement
    pos += dir;
    fxSweepPos[strip] = pos;
    if ( pos >= stripLen[strip]-1 ) {
      fxSweepDir[strip] = -1;
    } else if ( pos == 0 ) {
      fxSweepDir[strip] = 1;
    }

    // Set the new value
    ledVal[strip][pos] = color(60, 100, 100);
  }
}

int fxBarSweepPos = 0;
int fxBarSweepDir = 1;
int fxBarSweepSpeed = 2;
int fxBarSweepColor = 0;

void fxBarSweep() {
  int[] ledPair = horzOrder[fxBarSweepPos];

  // Clear out the last position
  for (int strip=0; strip<4; strip += 2) {
    ledVal[strip][ledPair[0]] = color(0);
    ledVal[strip+1][ledPair[1]] = color(0);
  }
  
  fxBarSweepPos += fxBarSweepDir;
  
  if (fxBarSweepPos >=334) {
    fxBarSweepPos = 334;
    fxBarSweepDir = -1 * fxBarSweepSpeed;
  } else if (fxBarSweepPos <= 0) {
    fxBarSweepPos = 0;
    fxBarSweepDir = 1 * fxBarSweepSpeed;
  }
  ledPair = horzOrder[fxBarSweepPos];

  fxBarSweepColor++;
  if (fxBarSweepColor > 100) {
    fxBarSweepColor = 0;
  }

  // Set the new position
  for (int strip=0; strip<4; strip += 2) {
    ledVal[strip][ledPair[0]] = color(fxBarSweepColor, 100, 100);
    ledVal[strip+1][ledPair[1]] = color(fxBarSweepColor, 100, 100);
  }
}

ArrayList<Mote> flame = new ArrayList<Mote>();
int maxMotes = 200; // Upper limit on number of motes to show
int maxCluster = 5; // Upper limit on number of motes to spawn at once

void fxFlame() {
  // Add some new motes if we can
  if (flame.size() < maxMotes) {
    int spark = int(random(maxCluster));
println("Flame.size() == " + flame.size() + " : sparking " + spark);
    for (int i=0; i<spark; i++) {
      int stripNum = int(random(4));
      flame.add(new Mote(stripNum));
    }
  }

  // Clear out all the current values  
  xformClear();

  //for (Mote mote : flame) {
  for (int i=0; i<flame.size(); i++) {
    Mote mote = flame.get(i);
    ledVal[mote.strip][mote.pos] = mote.col;
    mote.move();
    if (mote.isDead()) {
      flame.remove(mote); 
    }
  }
}

void clear() {
  fill(0);
  rect(0, 0, width, height);
  
  stroke(0,0,50);
  fill(0,0,0);
  triangle(633,17, 486,193, 45,193);
  triangle(664,17, 813,193, 1254,193);
  
  stroke(0, 0, 0);
}

